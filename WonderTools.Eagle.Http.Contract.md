# WonderTools.Eagle.Http.Contract

WonderTools.Eagle.Http.Contract details the communication between Eagle Dashboard and Eagle Node using Http. The current and the only version of WonderTools.Eagle.Http.Contract is 1.1.0

The below picture gives an overview of the communication between Dashboard and the client using WonderTools.Eagle.Http.Contract.

![WonderTools Eagle Http Contract](https://raw.githubusercontent.com/WonderTools/Eagle.Documentation/master/http-contract.JPG)

The communication has 3 parts to it.
1. Triggering the test by the Dashboard
2. Posting the partial test report by the Node
3. Responding to the test trigger request with the full test report by the Node.


### Triggering the test by the Dashboard
1. Initiated by Dashboard
2. Handled by Node
3. URL: The URL of the node registed with the dashboard
4. Method: POST
5. Payload is as shown below
```javascript
{
  "nodeName": "name of the node",
  "id": "testid",
  "callBackUrl": "http://dashboard-callback.url",
  "requestId": "request id",
  "nodeSecret": "node secret"
}
```
* __nodeName__
It's not necessary for node to know the name of the node. This also gives the possibility of different dashboards knowing the same node by different names. The nodeName is passed by the dashboard to the node, so that node can include this in the partial and full test report

* __id__
The id of the test case or the id of the test suite that needs to be executed. When empty (""), then all the test cases in the node are executed.

* __callBackUrl__
The url of the dashboard, where the partial test reports will be posted. If empty value is passed, then the node does not post back partial rest reports.

* __requestId__
A string to that is generated by dashboard to map the request it sends to partial result call backs.

* __nodeSecret__
A secret known by the node and dashboard. When the node secret is wrong in the test trigger request, the node should respond with forbidden. This provides a safety prevents unauthorized requestors. It's also possible that node does not have a secret in a highly trusted environment. For such a node, the nodeSecret is empty ("")

### Posting the partial results by the Node
The testing by the node could be a long process. To facilitate the dashboard from having the results earlier, this mechanism is provided. When the callBackUrl is valid in the request, then the all the test results are posted in one or more parts by the node to the call back url.

1. Initiated by Node
2. Handled by Dashboard
3. URL: The callBackUrl provided in the request
4. Method: POST
5. Payload is as shown below
```javascript
{
  "nodeName": "node-name",
  "requestId": "request-id",
  "testSuites": [
    {
      "id": "string",
      "fullName": "string",
      "name": "string",
      "testSuites": [
        null
      ],
      "testCases": [
        {
          "id": "string",
          "fullName": "string",
          "name": "string"
        }
      ]
    }
  ],
  "testResults": [
    {
      "id": "string",
      "result": "string",
      "startTime": "2019-07-02T11:11:53.694Z",
      "endTime": "2019-07-02T11:11:53.694Z",
      "durationInMs": 0
    }
  ]
}
```
* __nodeName__
The nodeName passed by the dashboard in the payload of test trigger

* __requestId__
The requestId passed by the dashboard in the payload of test trigger

* __testSuites__
The array of test suites that are available in the node. Each test suite has id, fullname, name. It also contains an array of test suites and an array of test cases, making a tree like structure.

* __testResults__
An array of test results. Each test result has id, result, startTime, endTime and durationInMs properties
